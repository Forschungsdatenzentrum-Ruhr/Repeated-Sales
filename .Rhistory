repeated_indices
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,4),
price = c(1, 3, 2,5,5))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,5,5))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dx
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,5,6))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
repeated_indices = dt_GRS[dt_ARS, on = "date"] |>  drop_na()
matrices <- with(
# na.omit here since update joins ignore nomatch = 0 argument
self_merged_rs_pairs,
rs_matrix(
t2 = date,
t1 = prev_date,
p2 = price_var,
p1 = prev_price_var,
f = kid2019, # grouping variable
sparse = F
)
)
# Prep --------------------------------------------------------------------
Z <- matrices("Z")
y <- matrices("y")
X <- matrices("X")
Y <- matrices("Y")
# GRS ---------------------------------------------------------------------
# index via Bailey(1963)
grs_b <- qr.coef(qr(Z), y)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
# GRS_vcov <- rs_var(y - Z %*% b, Z) |>
#   diag() |>
#   sqrt()
# ARS ---------------------------------------------------------------------
# index via Shiller (1991)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
# vcov <- rs_var(Y - X %*% ars_b, Z, X) |>
#   diag() |>
#   sqrt()
# ARS_vcov <- vcov * ARS^2
# combined ----------------------------------------------------------------
repeated_indices = dt_GRS[dt_ARS, on = "date"] |>  drop_na()
repeated_indices
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,5,6))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
Z
y
log(3/1)
log(1)
log(0)
X
Y
grs_b <- qr.coef(qr(Z), y)
grs_b
grs_b <- qr.coef(qr(Z), y) |> drop_na()
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ars_b
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,5,5))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,5,7))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 4,5,7))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,7))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
t(Z) %*% X
qr(t(Z) %*% X)
t(Z) %*% Y
Y
t(Z)
qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
?dt_GRS = data.table(date = names(GRS), GRS = GRS)
# GRS_vcov <- rs_var(y - Z %*% b, Z) |>
#   diag() |>
#   sqrt()
# ARS ---------------------------------------------------------------------
# index via Shiller (1991)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
# vcov <- rs_var(Y - X %*% ars_b, Z, X) |>
#   diag() |>
#   sqrt()
# ARS_vcov <- vcov * ARS^2
# combined ----------------------------------------------------------------
repeated_indices = dt_GRS[dt_ARS, on = "date"] |>  drop_na()
?dt_GRS = data.table(date = names(GRS), GRS = GRS)
# GRS_vcov <- rs_var(y - Z %*% b, Z) |>
#   diag() |>
#   sqrt()
# ARS ---------------------------------------------------------------------
# index via Shiller (1991)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
# vcov <- rs_var(Y - X %*% ars_b, Z, X) |>
#   diag() |>
#   sqrt()
# ARS_vcov <- vcov * ARS^2
# combined ----------------------------------------------------------------
repeated_indices = dt_GRS[dt_ARS, on = "date"] |>  drop_na()
?qr.coef
ars_b = solve(crossprod(Z,X),crossprod(Z,Y))
qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
dx <- data.frame(id = c(2,2),
date = c(4,5),
price = c(11,7))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,7))
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
GRS
grs_b
dx <- data.frame(id = c(1, 1),
date = c(1, 2),
price = c(1, 3))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,7))
dx <- data.frame(id = c(1, 1, 1),
date = c(1, 2, 3),
price = c(1, 3, 2))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,7))
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,7))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,2))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,11,13))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dx <- data.frame(id = c(1, 1, 1,2,2),
date = c(1, 2, 3,4,5),
price = c(1, 3, 2,1,1))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,6),
price = c(1, 3, 2,1,1,2))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
GRS
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,11),
price = c(1, 3, 2,1,1,13))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,11),
price = c(1, 3, 2,1,1,13))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,11),
price = c(1, 3, 2,1,1,13))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,11),
price = c(1, 3, 2,1,1,13))
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
dx
dx <- data.frame(id = c(1, 1, 1,2,2,2),
date = c(1, 2, 3,4,5,11),
price = c(1, 3, 2,1,1,13))
dx
dx[c("date_prev","price_prev")] = dx[rs_pairs(dx$date,dx$id),c("date","price")]
dx = subset(dx,date > date_prev)
dx
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
rs_matrix
dx
matrix_const = with(dx, rs_matrix(date,date_prev,price,price_prev))
Z <- matrix_const("Z")
y <- matrix_const("y")
X <- matrix_const("X")
Y <- matrix_const("Y")
grs_b <- qr.coef(qr(Z), y) |> setdiff(NA)
GRS <- (exp(grs_b) * 100) |> formatC(format = "f", digits = 4)
dt_GRS = data.table(date = names(GRS), GRS = GRS)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
qr(t(Z) %*% X)
t(Z) %*% Y
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
)
ars_b
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> setdiff(NA)
ars_b
?setdiff
ars_b <- qr.coef(
qr(t(Z) %*% X),
t(Z) %*% Y
) |> na.omit()
100/0
is.finite(100/0)
ars_b[ars_b == 0] = NA
ARS = (100 / ars_b)|> formatC(format = "f", digits = 4)
dt_ARS = data.table(date = rownames(ars_b),ars_b = ars_b, ARS = ARS)
repeated_indices = dt_GRS[dt_ARS, on = "date"] |>  drop_na()
tar_make()
tar_load(repeated_index )
View(repeated_index)
