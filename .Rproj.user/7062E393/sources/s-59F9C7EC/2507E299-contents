read_RED <- function(RED_file_name = NA, var_of_interest = NA) {
  #' @title WIP
  #'
  #' @description WIP
  #' @param WIP
  #' @param WIP
  #' @note
  #'
  #' @return WIP
  #' @author Thorben Wiebe
  #----------------------------------------------

  # read stata file and remove labels
  RED <- haven::read_dta(RED_file_name) |>
    haven::zap_labels() |>
    data.table::setDT()

  logger::log_info("Initial Observations: ", RED[,.N])
  
  RED <- RED[
    # drop missings for all but pricing variables since one of those is always missing
    RED[,
      Reduce("&", lapply(.SD, ">=", 0)),
      .SDcols = setdiff(var_of_interest, c("mietekalt", "kaufpreis"))
    ],
    # keep only relevant variables
    ..var_of_interest
  ][,
    ## mutations
    ":="(
      # combine coordinates
      latlon_utm = paste0(lat_utm, lon_utm),

      # transform years into months and add running years months
      amonths = ajahr * 12 + amonat,
      emonths = ejahr * 12 + emonat,

      # combine price and rent into one variable
      price_var = pmax(mietekalt, kaufpreis),

      # create unique id for entire data
      counting_id = 1:.N,

      # cleanup
      ajahr = NULL,
      amonat = NULL,
      ejahr = NULL,
      emonat = NULL,
      mietekalt = NULL,
      kaufpreis = NULL

      # TODO
      # get enddate of date
      # data_end_date = max(emonths)

    )
  ]
  setkey(RED, blid, latlon_utm)
  
  logger::log_info("Post Reading Observations: ", RED[,.N])
  
  # mass write federal state level files
  # TODO: adjust for different versions wm/wk
  # RED[, fst::write.fst(.SD, glue::glue("{data_path}/RED_{RED_type}_blid{.BY}.fst")), by = blid]
  # 
  # out = data.table(blid = 1:16, fs_file_name = glue::glue("RED_{RED_type}_blid{1:16}"))

  return(RED)
}
